{"componentChunkName":"component---src-templates-blog-post-js","path":"/tdd-em-ios/","result":{"data":{"site":{"siteMetadata":{"title":"Felipe Mendes"}},"markdownRemark":{"id":"b937714a-0f8d-5bbf-9abc-55e7a8c53b66","excerpt":"Desenvolvimento guiado por testes, ou Test Driven Development, é uma técnica de programação muito comum em equipes que almejam uma cobertura de teste em seus…","html":"<p>Desenvolvimento guiado por testes, ou <strong>Test Driven Development</strong>, é uma técnica de programação muito comum em equipes que almejam uma cobertura de teste em seus códigos e minimizar as chances de erros, bem como comportamentos inesperados. Neste texto, irei abordar o conceito de <strong>TDD</strong> e como utilizo esta técnica em meus projetos.</p>\n<p>Testes em geral visam reduzir o tempo de desenvolvimento e garantir a funcionalidade do código em futuras adaptações. O principal empecilho, pelo menos pra mim, é mudar a rotina de desenvolvimento para utilizar testes.</p>\n<h2>O que é TDD?</h2>\n<p>O conceito de TDD se resume em escrever um teste antes do seu código existir. Primeiro deve-se escrever um teste com falha e em seguida adicionar o mínimo de código necessário para validá-lo. Quando o teste for executado com sucesso a próxima etapa é refatorar tanto o código quanto o teste. Após a refatoração, o comportamento de ambos deve permanecer idêntico.</p>\n<p>Esse processo quando executado de forma correta permite que todo o aplicativo esteja coberto por testes. Assim não será necessário gastar tempo extra adicionando testes posteriormente e teremos a confiança no comportamento do código. Vale ressaltar que o <code class=\"language-text\">Code Coverage</code> não é um indicador que o código é confiável. A cobertura do código indica apenas quais trechos de código foram testados, a qualidade do teste é responsabilidade do desenvolvedor.</p>\n<h3>Ciclo <em>Red-Green-Refactor</em></h3>\n<div style=\"text-align:center\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 371px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/461ab7ea1037e4ba41f8519627af2fa0/d4635/Red-Green-Refactor.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 117.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAELElEQVQ4y5WU+09TZxjH+WeWJRrdZNwLCAyUi+hwQ8C5jfnDRLbETd0cc3PK3DKzmWUmM5OJkW1Opdyk5V7KxUKtMdE2gHMT6tBCa+mVgvRyzmeHttACkmxvcnLek/c5n/f7fd7nfWJYNURRDL59Xi9up5P5uTm8CwusF7d6xKwXaLNaGezupLuliaHeHu7r76HtU6NRdXNXd2s5djV4XaAgCEGFVrMZp92OxWRi4sGfwW+b9el/BIYX17PzvyxH7yaKAmIgEMnn5D94VJ2hQAECQgBBinmeypg1MAm0NIT5OXwPxnD/Wos5K5nHd9TYxLnl9UXwasUxz4MJs25ma89jLd3JdOrLPIl7EUviJu5u28yR34r5WfcjVrc5FCsGopyJIWA0zDeqx753B5b4F7CkbsKSFS+pS8SUEYs7IRZVSSwFl5N4949d3Ho0GAUNA6Nh/jEDjrwkZtI2YstPwbo9kacpGzAnSAozXmE6cSMXPk+jvCGf0ro0ii7JGDb2r7AfUTjnwVW+E0dROs69edhfjWUm8yVcRytwfV+NQ7J++9Q+ypW5vHMllcPNxXzQsJv9V/Mxu01hpYIEDKt7Vn8Ze8YGXKcO4TxYgrNQhrevK7T75CNcXx1jceu/rQaOtL5GlbKUnwY+Y09dAjXaMxFgUJ0k131wD86K13H98AWOggS86o7IaTtsQQdLxTFhG6WiMZMazXFOdpRzUEqB65k9UjaBx0ZcJRnYy7Kw707FdWR/8GdRui2Lz3JpSPOA4A/OL+pOcKg5Jwg9IM/inmk4AvTf0+Hak4avOJVn2zfh++UsS8rFVXW6BBwcb+BAQxzH24t4Ty5jcEIRBdTrcJalozq8n9tvFzB16Ry+sCJW36DwXGOU82FLPMfatlHZmMyQURkCBg09+gv9+yXI6ptJvtZE7pXrlLd10T5ujLpeIesjZjUPZ3Q0GKr5tD2JE105fKxI574l1IFigmc87+HC75eIb1KS3XiDLVfq+VZ3J3xyIn5JqT9sdcYzxtmBTL7pzeRrVSYnu7dK80LcCzMRyz7ph+K+myQ3K8i+0U66BN2l6KDviWlNN9GZrFSr9/Fdfwpn+nP4sjuBlpHTK8vm9oyN0/oR3uzXIGttJ0fRSWpTK4lSCiqljc5LazWGUT5S97OlVk5ZQxUXb8VxTiPjdG+cdOLlTDoMEYUOry/4oXc42dbTR5qUv2zpeaOrhwJFGztuKNkqbyK7vpE8eSu51y9ToaykRP4JqvFenPNGZhdsK69eIPw2SNAyjZY4ZSdv9Q9wXKelSjvMsSENR28OUqlSsbnuGulXlSgeTq1puiv64RLU5fNR83CC0pta0jt6SJHymdLSRnKTgkJJ+Zk7dzF5Zpc7jRBVTmsabCCq+3r8fkadLvrMFnqnptHb7FJ6vFENVljRCxfHv3TPLD4umAJhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Red Green Refactor\" title=\"Red Green Refactor\" src=\"/static/461ab7ea1037e4ba41f8519627af2fa0/d4635/Red-Green-Refactor.png\" srcset=\"/static/461ab7ea1037e4ba41f8519627af2fa0/c26ae/Red-Green-Refactor.png 158w,\n/static/461ab7ea1037e4ba41f8519627af2fa0/6bdcf/Red-Green-Refactor.png 315w,\n/static/461ab7ea1037e4ba41f8519627af2fa0/d4635/Red-Green-Refactor.png 371w\" sizes=\"(max-width: 371px) 100vw, 371px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span></div>\n<p>Essas etapas comuns em <strong>TDD</strong> são conhecidas como <em>Red-Green-Refactor</em>:</p>\n<ol>\n<li>Red: Escrever um teste com falha</li>\n<li>Green: Escrever a quantidade mínima necessária para validá-lo</li>\n<li>Refactor: Refatorar tanto o código quanto o teste</li>\n</ol>\n<h2>Etapas do TDD</h2>\n<p>Iniciar testes com <strong>TDD</strong> pode aparentar um tanto ou quanto abstrato ter que criar um teste para um código que ainda não existe. Há diversas especifícações que nos ajudam nesta etapa. Uma solução adotada por muitos desenvolvedores é estruturar os testes com as fases do conceito de <a href=\"https://martinfowler.com/bliki/GivenWhenThen.html\">Given-When-Then</a>.</p>\n<h3>Given-When-Then</h3>\n<p>Essa solução facilita a leitura e cria uma padronização aos nossos testes:</p>\n<h4>Given</h4>\n<p>Aqui deve ser definido os dados necessários para a construção do nosso cenário. As instâncias devem ser <em>mockadas</em> para facilitar a especificação do cenário almejado. Ou seja, essa etapa contém todos os pré-requisitos para a execução do teste.</p>\n<h4>When</h4>\n<p>É a etapa onde o comportamento do teste é invocado. Aqui devemos informar o método que deverá ser testado.</p>\n<h4>Then</h4>\n<p>Na última etapa deve ser definido o objetivo esperado do comportamento. Podemos verificar o retorno da declaração informada. </p>\n<h2>Como aplicar</h2>\n<p>Vamos utilizar o <strong>TDD</strong> para criar uma validação de e-mails. O método a ser testado deve retornar um <em>boolean</em> a partir do texto fornecido como argumento. Neste exemplo, usarei o <em>framework XCTest</em> de testes unitários da <em>Apple</em>.</p>\n<p>Cada comportamento deve ser testado individualmente. Portanto, vamos primeiro testar o caso de sucesso para o e-mail fornecido. Aplicando a estrutura do <strong>TDD</strong> nosso método deverá ter esta organização:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">SampleAppTests</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">XCTestCase</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">test_email_is_valid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Given</span>\n\n        <span class=\"token comment\">// When</span>\n\n        <span class=\"token comment\">// Then</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Como ainda não temos nenhum código criado devemos começar criando a assinatura do método na etapa <strong>When</strong>. Dessa forma, para validar um e-mail precisamos criar a chamada do método recebendo um valor como argumento. Em <strong>Given</strong> podemos isolar o e-mail que será validado:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">test_email_is_valid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Given</span>\n    <span class=\"token keyword\">let</span> email <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"email\"</span></span>\n\n    <span class=\"token comment\">// When</span>\n    sut<span class=\"token punctuation\">.</span><span class=\"token function\">isValid</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Then</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>A sigla <strong>SUT</strong> signifca <em>System Under Test</em> e é muito comum utiliza-lá para se referir à classe que estamos testando.</p>\n</blockquote>\n<p>Com este código o <em>Xcode</em> exibirá um erro no identificador <em>sut</em>. Nosso <em>sut</em> será a classe que irá conter o método <em>isValid()</em>. Vamos especificar o nome da classe de teste na etapa <strong>Given</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">test_email_is_valid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Given</span>\n    <span class=\"token keyword\">let</span> sut <span class=\"token operator\">=</span> <span class=\"token class-name\">EmailValidator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> email <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"email\"</span></span>\n\n    <span class=\"token comment\">// When</span>\n    sut<span class=\"token punctuation\">.</span><span class=\"token function\">isValid</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Then</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Para resolver este erro devemos construir nossa classe. A criação de classes e objetos necessários para o testes podem ser criados no mesmo arquivo pois o primeiro objetivo é fazer nosso teste ser validado.</p>\n<p>O código suficiente pode ser <em>hardcoded</em> e sem regras, precisamos apenas instânciar a classe e invocar nosso método:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">final</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EmailValidator</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">isValid</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> email<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Em seguida vamos definir o objetivo do teste na etapa <strong>Then</strong>. Como nosso método retornará um <em>boolean</em> indicando se o e-mail é válido podemos verificar se o retorno é verdadeiro através de um <em>assert</em>. E para facilitar a leitura podemos associar o retorno à uma constante:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">test_email_is_valid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Given</span>\n    <span class=\"token keyword\">let</span> sut <span class=\"token operator\">=</span> <span class=\"token class-name\">EmailValidator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> email <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"email\"</span></span>\n\n    <span class=\"token comment\">// When</span>\n    <span class=\"token keyword\">let</span> validate <span class=\"token operator\">=</span> sut<span class=\"token punctuation\">.</span><span class=\"token function\">isValid</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Then</span>\n    <span class=\"token class-name\">XCTAssertTrue</span><span class=\"token punctuation\">(</span>validate<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ao executar o teste agora o <em>Xcode</em> retornará sucesso.</p>\n<p>Teste validado a próxima etapa é refator o código que verifica a entrada informada. O exemplo abaixo realiza a validação de e-mail com <em>regex</em>. Mais detalhes sobre esse padrão <a href=\"https://emailregex.com\">aqui</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">final</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EmailValidator</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> pattern <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\\\\.[A-Za-z]{2,64}\"</span></span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">isValid</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> email<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> range <span class=\"token operator\">=</span> <span class=\"token class-name\">NSRange</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">:</span> email<span class=\"token punctuation\">.</span>utf16<span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> regex <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span><span class=\"token operator\">?</span> <span class=\"token class-name\">NSRegularExpression</span><span class=\"token punctuation\">(</span>pattern<span class=\"token punctuation\">:</span> pattern<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> regex<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">firstMatch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">:</span> email<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> range<span class=\"token punctuation\">:</span> range<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token nil constant\">nil</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Com esse trecho de código nosso <em>XCTAssertTrue</em> retornará <em>false</em> pois a constante do e-mail não é uma entrada válida. Basta substituir por um e-mail verdadeiro e verificar a validação:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">test_email_is_valid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Given</span>\n    <span class=\"token keyword\">let</span> sut <span class=\"token operator\">=</span> <span class=\"token class-name\">EmailValidator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> email <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"nome@email.com\"</span></span>\n\n    <span class=\"token comment\">// When</span>\n    <span class=\"token keyword\">let</span> validate <span class=\"token operator\">=</span> sut<span class=\"token punctuation\">.</span><span class=\"token function\">isValid</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Then</span>\n    <span class=\"token class-name\">XCTAssertTrue</span><span class=\"token punctuation\">(</span>validate<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Este exemplo é um pouco sobre o processo de <strong>TDD</strong> e como pode ser aplicado em aplicações <em>iOS</em>.</p>","frontmatter":{"title":"TDD em iOS","date":"01 julho, 2020","description":""}},"previous":{"fields":{"slug":"/metodos-opcionais-em-protocolos/"},"frontmatter":{"title":"Métodos opcionais em Protocolos"}},"next":{"fields":{"slug":"/variacoes-do-nslayoutxaxisanchor/"},"frontmatter":{"title":"Variações do NSLayoutXAxisAnchor"}}},"pageContext":{"id":"b937714a-0f8d-5bbf-9abc-55e7a8c53b66","previousPostId":"b00a1c89-cee2-5cb4-948f-964cc8bbc0ec","nextPostId":"4c406269-8648-5361-ba33-6183e4512c7f"}},"staticQueryHashes":["1344965497","2841359383"]}