{"componentChunkName":"component---src-templates-blog-post-js","path":"/json-serialization/","result":{"data":{"site":{"siteMetadata":{"title":"Felipe Mendes"}},"markdownRemark":{"id":"6a3bc715-4e2e-5003-b0ab-018d3013b38b","excerpt":"Durante o desenvolvimento de aplicativos é muito comum realizar uma comunicação com informações externas via rede. Para estabelecer esta comunicação é…","html":"<p>Durante o desenvolvimento de aplicativos é muito comum realizar uma comunicação com informações externas via rede. Para estabelecer esta comunicação é necessário formatar os dados tanto para enviá-los quanto para recebê-los. Em <code class=\"language-text\">Swift</code> esse processo é conhecido como <strong>Encodable</strong> e <strong>Decodable</strong>.</p>\n<p>Segundo a documentação:</p>\n<ul>\n<li>Encodable: Um tipo que pode se <strong>codificar para</strong> uma representação externa.</li>\n<li>Decodable: Um tipo que pode <strong>decodificar a partir</strong> de uma representação externa.</li>\n</ul>\n<p>Uma maneira de utilizar ambos protocolos em uma mesma entidade é conformar com o <code class=\"language-text\">alias</code> <strong>Codable</strong>. O <code class=\"language-text\">Codable</code> foi introduzido no <code class=\"language-text\">Swift 4</code> como substituto ao <code class=\"language-text\">NSCoding</code>. Portanto, esse tipo permite codificar e decodificar para formatos diferentes.</p>\n<p>Ao informar que uma entidade conforma com estes protocolos é necessário que todas as suas propriedades também conformem com o protocolo indicado. Muitos tipos comuns do <a href=\"https://developer.apple.com/documentation/swift/swift_standard_library\">Swift Standard Library</a> e <a href=\"https://developer.apple.com/documentation/foundation\">Foundation</a> são <code class=\"language-text\">codable</code> por padrão. Quando houver um tipo customizado, é necessário que este também se conforme com o protocolo.</p>\n<p>No exemplo a seguir podemos verificar o erro emitido pelo Xcode quando tentamos conformar o tipo <code class=\"language-text\">Student</code> com <code class=\"language-text\">Codable</code>. Como o tipo <code class=\"language-text\">School</code> não tem essa especificação, <code class=\"language-text\">Student</code> não está em total conformidade. Os demais tipo, <code class=\"language-text\">Int</code> e <code class=\"language-text\">String</code>, não geram erros pois são importados do framework <code class=\"language-text\">Foundation</code>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6915bbfb7bae398c24617e2e69a8bded/a0209/disconformed-protocol.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA9ElEQVQY05WPy07DMBBF8xksEtuJ0zyVp900DS3pK4lAlSgsWLDg///iMk0qFBALWBzd8Wh0ZmyosMRydY+qahD6CVzHh83dEYcwmYRp2mCEdcufjH3LAadZo4k1knqPldpgna+RBSk8IeELF5JL9EGEvtBo1RK7UuOhUGivUN0WE3tdYZuXqPwIRualWJAs1Ruoegtue7BoE6fr7mjre5rj49ThMjzitR9wOfV4PnZjvnTDWL89nXHeHdDECQwhFhBOAEYCxicRvwkn5vVv73mfvlxGGmHVIstrOHQdY98HGcn/jgsjlDFkXCK+EhZfknn+h0+XNLFQOQzaPgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Disconformed Protocol\"\n        title=\"Disconformed Protocol\"\n        src=\"/static/6915bbfb7bae398c24617e2e69a8bded/f058b/disconformed-protocol.png\"\n        srcset=\"/static/6915bbfb7bae398c24617e2e69a8bded/c26ae/disconformed-protocol.png 158w,\n/static/6915bbfb7bae398c24617e2e69a8bded/6bdcf/disconformed-protocol.png 315w,\n/static/6915bbfb7bae398c24617e2e69a8bded/f058b/disconformed-protocol.png 630w,\n/static/6915bbfb7bae398c24617e2e69a8bded/a0209/disconformed-protocol.png 725w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Encoding</h2>\n<p>Como vimos, o protocolo <strong>Encodable</strong> permite o tipo para ser enviado à uma camada externa do aplicativo. É possível codificar nossos tipos para diversos formatos, como <code class=\"language-text\">JSON</code>, <code class=\"language-text\">XML</code> e <code class=\"language-text\">Plist</code>.</p>\n<p>Para preparar nosso tipo com o formato <code class=\"language-text\">JSON</code> podemos utilizar <code class=\"language-text\">JSONEncoder</code> da seguinte maneira:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Student</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Codable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> id<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Int</span>\n    <span class=\"token keyword\">var</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n    <span class=\"token keyword\">var</span> school<span class=\"token punctuation\">:</span> <span class=\"token class-name\">School</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">School</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Codable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> school <span class=\"token operator\">=</span> <span class=\"token class-name\">School</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Swift School\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> student <span class=\"token operator\">=</span> <span class=\"token class-name\">Student</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Steve Jobs\"</span></span><span class=\"token punctuation\">,</span> school<span class=\"token punctuation\">:</span> school<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">let</span> encoder <span class=\"token operator\">=</span> <span class=\"token class-name\">JSONEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>student<span class=\"token punctuation\">)</span></code></pre></div>\n<p>É possível visualizar como está a representação <code class=\"language-text\">JSON</code> ao converter para <code class=\"language-text\">String</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">,</span> encoding<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>utf8<span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Steve Jobs\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"school\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Swift School\"</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Como podemos ver, os dados são aninhados conforme estrutura declarada nas <code class=\"language-text\">structs</code>.</p>\n<h2>Decoding</h2>\n<p>Para realizar o processo inverso, ou seja, para decodificar instâncias de um tipo de dados a partir de objeto <code class=\"language-text\">JSON</code>, podemos utilizar o <code class=\"language-text\">JSONDecoder</code>.</p>\n<p>Nesse processo precisamos especificar o tipo para a conversão e a origem dos dados. No exemplo abaixo foi utilizado um <code class=\"language-text\">JSON</code> <code class=\"language-text\">hardcoded</code> mas a origem pode ser de qualquer lugar.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> json <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"\"\n{\n    \"id\": 2,\n    \"name\": \"Tim Cook\",\n    \"school\": {\n        \"name\": \"Swift School\"\n    }\n}\n\"\"\"</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>using<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>utf8<span class=\"token punctuation\">)</span><span class=\"token operator\">!</span>\n\n<span class=\"token keyword\">let</span> decoder <span class=\"token operator\">=</span> <span class=\"token class-name\">JSONDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> studentFromJson <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> decoder<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> from<span class=\"token punctuation\">:</span> json<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Ao manipularmos o objeto que recebeu a decodificação podemos perceber que este possui todas as propriedades das <code class=\"language-text\">structs</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Objeto estudante: </span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">studentFromJson</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Nome estudante: </span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">studentFromJson<span class=\"token punctuation\">.</span>name</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Escola do estudante: </span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">studentFromJson<span class=\"token punctuation\">.</span>school<span class=\"token punctuation\">.</span>name</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Chaves JSON personalizadas</h2>\n<p>Para realizar os processos de envio e recebimento das informações é necessário que as chaves dos campos estejam corretas, caso contrário, ou a <code class=\"language-text\">API</code> ou o nosso aplicativo não reconhecerá o dado trafegado.</p>\n<p>Afim de evitar refatoração futura de campos, podemos definir <strong>chaves de codificação personalizadas</strong> para as propriedades. Esse processo é feito ao definir o <code class=\"language-text\">enum</code> que conforme com o protocolo <code class=\"language-text\">CodingKeys</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">enum</span> <span class=\"token class-name\">CodingKeys</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CodingKey</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> id\n        <span class=\"token keyword\">case</span> name <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"nome\"</span></span>\n        <span class=\"token keyword\">case</span> school <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"escola\"</span></span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">School</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">enum</span> <span class=\"token class-name\">CodingKeys</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CodingKey</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> name <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"nome\"</span></span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Todos os campos da <code class=\"language-text\">struct</code> devem estar listados como <code class=\"language-text\">case</code>. Quando esse <code class=\"language-text\">enum</code> existir apenas esses <code class=\"language-text\">cases</code> que serão utilizados na codificação e decodificação, portanto, mesmo que alguma propriedade não exija mapeamento, ela deverá ser incluída.</p>\n<p>Após estas modificações a visualização do JSON será assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token string-literal\"><span class=\"token string\">\"id\"</span></span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string-literal\"><span class=\"token string\">\"nome\"</span></span><span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Steve Jobs\"</span></span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string-literal\"><span class=\"token string\">\"escola\"</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token string-literal\"><span class=\"token string\">\"nome\"</span></span><span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Swift School\"</span></span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Modificando hierarquia JSON</h2>\n<p>Também é possível alterar a hierarquia do <code class=\"language-text\">JSON</code> sem modificar nosso modelo de estrutura. Essa modificação possibilita criar hierarquias simples às mais complexas com aninhamentos.</p>\n<h3>Encodable</h3>\n<p>Em codificação, é necessário implementar o método <code class=\"language-text\">encode(to:)</code> para especificar a estrutura. Esse processo é baseado na criação de um dicionário do tipo <code class=\"language-text\">KeyedEncodingContainer</code> para armazenar as propriedades.</p>\n<p>O exemplo abaixo mostra a alteração para uma estrutura direta sem o aninhamento anterior:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">encode</span><span class=\"token punctuation\">(</span>to encoder<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Encoder</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> container <span class=\"token operator\">=</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">container</span><span class=\"token punctuation\">(</span>keyedBy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">CodingKeys</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">try</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">try</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">try</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>school<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>school<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>A exibição do <code class=\"language-text\">JSON</code> fica dessa forma:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"nome\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Steve Jobs\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"escola\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Swift School\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Quando necessário aumentar o nível do aninhamento podemos utilizar o método <code class=\"language-text\">nestedContainer(keyedBy:forKey:)</code>. Para instanciar esse método é obrigatório informar um <code class=\"language-text\">enum</code> que também conforme com o protocolo <code class=\"language-text\">CodingKey</code> e também informar a chave de posicionamento do novo aninhamento.</p>\n<p>No exemplo abaixo, alteramos o método <code class=\"language-text\">encode(to:)</code> para exibir um novo grupo de escolas:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">enum</span> ​<span class=\"token class-name\">SchoolKeys</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CodingKey</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> best <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"melhores_escolas\"</span></span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">encode</span><span class=\"token punctuation\">(</span>to encoder<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Encoder</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        <span class=\"token keyword\">var</span> schoolContainer <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">nestedContainer</span><span class=\"token punctuation\">(</span>keyedBy<span class=\"token punctuation\">:</span> ​<span class=\"token class-name\">SchoolKeys</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>school<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">try</span> schoolContainer<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>school<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>best<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>O resultado do <code class=\"language-text\">JSON</code> será assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"nome\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Steve Jobs\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"escola\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">\"melhores_escolas\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"nome\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Swift School\"</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Decodable</h3>\n<p>No processo de decodificação devemos implementar as modificações no construtor <code class=\"language-text\">init(from:)</code>. Ou seja, como este é o ponto de entrada dos dados é onde devemos modificar a estrutura.</p>\n<p>Para recebermos a seguinte estrutura:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"nome\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Steve Jobs\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"escola\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Swift School\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Devemos modificar a entrada dessa forma:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>from decoder<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Decoder</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> container <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> decoder<span class=\"token punctuation\">.</span><span class=\"token function\">container</span><span class=\"token punctuation\">(</span>keyedBy<span class=\"token punctuation\">:</span> <span class=\"token class-name\">CodingKeys</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n        name <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n        id <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> schoolName <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>school<span class=\"token punctuation\">)</span>\n        school <span class=\"token operator\">=</span> <span class=\"token class-name\">School</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">:</span> schoolName<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Para aumentar o nível do aninhamento na entrada dos dados pode utilizar o método <code class=\"language-text\">nestedContainer(keyedBy:forKey:)</code>:</p>\n<p>Para adaptar à entrada do <code class=\"language-text\">JSON</code> abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"nome\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Steve Jobs\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"escola\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">\"melhores_escolas\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"nome\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Swift School\"</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>O <code class=\"language-text\">init</code> deve ficar dessa forma:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>from decoder<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Decoder</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n\n        <span class=\"token keyword\">let</span> schoolContainer <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">nestedContainer</span><span class=\"token punctuation\">(</span>keyedBy<span class=\"token punctuation\">:</span> ​<span class=\"token class-name\">SchoolKeys</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>school<span class=\"token punctuation\">)</span>\n        school <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> schoolContainer<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">School</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>best<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Datas com <code class=\"language-text\">Codable</code></h2>\n<p>Pode-se dizer que, lidar com datas em programação é um sofrimento para a maiorida dos desenvolvedores. Principalmente quando é necessário trafegar datas entre cliente e servidor. O importante nesse case é atender ao fato que o envio e recebimento de datas é feito como <code class=\"language-text\">String</code>, mas para haver a comunicação, deve ser estabelecido um formatado para esta informação.</p>\n<p>Portanto, vamos adicionar um novo campo com data ao <code class=\"language-text\">JSON</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"nome\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Steve Jobs\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"data_nascimento\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"24-02-1955\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"escola\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">\"nome\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Swift School\"</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Para facilitar a manipulação, podemos extender a classe <code class=\"language-text\">DateFormatter</code> com o formato de data do <code class=\"language-text\">JSON</code>. No exemplo abaixo é utilizado uma propriedade para facilitar seu reuso:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">DateFormatter</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">let</span> dateFormatter<span class=\"token punctuation\">:</span> <span class=\"token class-name\">DateFormatter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> formatter <span class=\"token operator\">=</span> <span class=\"token class-name\">DateFormatter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        formatter<span class=\"token punctuation\">.</span>dateFormat <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"dd-MM-yyyy\"</span></span>\n        <span class=\"token keyword\">return</span> formatter\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Essa propriedade deve ser vinculada ao <code class=\"language-text\">JSONEncoder</code> e <code class=\"language-text\">JSONDecoder</code> nas propriedades <code class=\"language-text\">.dateEncodingStrategy</code> e <code class=\"language-text\">.dateDecodingStrategy</code>, respectivamente:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> encoder <span class=\"token operator\">=</span> <span class=\"token class-name\">JSONEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nencoder<span class=\"token punctuation\">.</span>dateEncodingStrategy <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token function\">formatted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span>dateFormatter<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">let</span> decoder <span class=\"token operator\">=</span> <span class=\"token class-name\">JSONDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ndecoder<span class=\"token punctuation\">.</span>dateDecodingStrategy <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token function\">formatted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span>dateFormatter<span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"title":"JSON Serialization","date":"16 junho, 2020","description":""}},"previous":{"fields":{"slug":"/auto-layout-programaticamente/"},"frontmatter":{"title":"Auto Layout programaticamente"}},"next":{"fields":{"slug":"/metodos-opcionais-em-protocolos/"},"frontmatter":{"title":"Métodos opcionais em Protocolos"}}},"pageContext":{"id":"6a3bc715-4e2e-5003-b0ab-018d3013b38b","previousPostId":"100cddcd-efa4-50b0-ab63-0d7b611c4bae","nextPostId":"5a71552c-9765-5eac-89ac-36fa6ab18ad6"}},"staticQueryHashes":["1344965497","2841359383"]}